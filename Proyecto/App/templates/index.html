<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Somos Magas - Inicio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <script>
    function irAPagar() {
        alert('Ir a pagar');
    }

    function openNav() {
        document.getElementById("sidepanel").style.width = "20%";
    }

    function closeNav() {
        document.getElementById("sidepanel").style.width = "0";
    }

    function pagar() {
        alert('Pagar');
    }

    </script>
</head>
<body>

    <header class="sticky-top">
        <div style="float: left; margin-left: 50px;">
            <img src="../static/img/logo1.png" alt="logo" style="max-width: 125px;">
        </div>
        <div class="cart" style="float: right;">
            <button class="cart btn" onClick="openNav()" style="object-position: top;">
                <img src="../static/img/product/cart.png" alt="logo2" style="max-width: 65px; margin-right: 60px;">
            </button>
            <div id="sidepanel" class="sidepanel">
                <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                <div>
                    <div>
                        <div id="cartside"></div>
                        <br>
                        <p id="sumaPago">Total: </p>
                        <br>
                        <button style="float:left; position: relative;bottom: 20px;" onclick="pagar()">Pagar</button>
                    </div>
                </div>
            </div>
        </div>
        <h1 style="margin-left: 95px"><strong>Somos Magas</strong></h1>
        <nav style="margin-left: 95px; margin-right: auto; text-align: center;">
            <a href="{% url 'index' %}">Inicio</a>
            <a href="{% url 'servicios' %}">Servicios</a>
            <a href="{% url 'productos' %}">Productos</a>
            <a href="{% url 'contacto' %}">Contacto</a>
        </nav>
        <!-- Agregar el enlace para iniciar sesión -->
        <div style="float: right; margin-right: 50px; padding-top: 20px;">
            <a href="{% url 'login' %}" style="font-size: 18px; color: #333; text-decoration: none;">Iniciar sesión</a>
        </div>
    </header>
    

<main>
    <section id="carousel">
        <h2 style="text-align: center;">Bienvenidos a Somos Magas</h2>
        <br>
        <div class="carousel">
            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="true">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0"
                            class="active" aria-current="true" aria-label="Slide 1"></button>
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
                            aria-label="Slide 2"></button>
                    </div>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="..\static\img\Somos Magas-16.JPG" alt="slide_1">
                        </div>
                        <div class="carousel-item">
                            <img src="..\static\img\Somos Magas-2.JPG" style="object-position: bottom;" alt="slide_2">
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section id="instagram">
        <h3>Últimas publicaciones en Instagram</h3>
        <div class="instagram-container">
            <div class="instagram-card">
                <h5 class="card-title"></h5>
                <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/C6HIAgyO94k/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="14" style="background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px auto; max-width:100%; min-width:326px; padding:0; width:100%;">
                    <!-- contenido del bloque -->
                </blockquote>
                <script async src="//www.instagram.com/embed.js"></script>
            </div>
            <div class="instagram-card">
                <h5 class="card-title"></h5>
                <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/C4ajDusOBZi/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="14" style="background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px auto; max-width:100%; min-width:326px; padding:0; width:100%;">
                    <!-- contenido del bloque -->
                </blockquote>
                <script async src="//www.instagram.com/embed.js"></script>
            </div>
        </div>
    </section>
</main>

<button onclick="scrollToTop()" id="scrollToTopBtn" title="Go to top">⬆</button>

<script>
    // Mostrar/ocultar el botón basado en el desplazamiento
    window.onscroll = function() {scrollFunction()};

    function scrollFunction() {
        const scrollToTopBtn = document.getElementById("scrollToTopBtn");
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            scrollToTopBtn.style.display = "block";
        } else {
            scrollToTopBtn.style.display = "none";
        }
    }

    // Función para desplazarse al inicio
    function scrollToTop() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }
</script>

<footer>
    <p>&copy; 2024 Somos Magas</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>


    function reducirDelCarrito(productId) {
        console.log("Reducing product with ID:", productId); // Debugging log
        $.ajax({
            url: "{% url 'reducir_del_carro' 0 %}".replace('0', productId),
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(response) {
                console.log("Response from server:", response); // Debugging log
                if (response.status === 'success') {
                    const product = response.carro.find(product => product.id_producto === productId);
                    if (product && product.cantidad > 0) {
                        $(`#producto-${productId} .cantidad`).text(`Cantidad: ${product.cantidad}`);
                    } else {
                        $(`#producto-${productId}`).remove();
                    }
                    actualizarTotal(response.carro); // Update total after quantity change or removal
                } else {
                    alert(response.message);
                }
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    }

    function eliminarDelCarrito(productId) {
console.log("Deleting product with ID:", productId); // Debugging log
$.ajax({
    url: "{% url 'eliminar_del_carro' 0 %}".replace('0', productId), // Update URL for removing
    type: 'POST',
    data: {
        'csrfmiddlewaretoken': '{{ csrf_token }}'
    },
    success: function(response) {
        console.log("Response from server:", response); // Debugging log
        if (response.status === 'success') {
            $(`#producto-${productId}`).remove(); // Remove product element from DOM
            actualizarTotal(response.carro); // Update total after removal
        } else {
            alert(response.message);
        }
    },
    error: function(xhr, errmsg, err) {
        console.log(xhr.status + ": " + xhr.responseText);
    }
});
}


    function aumentarDelCarrito(productId) {
        console.log("Increasing product with ID:", productId); // Debugging log
        $.ajax({
            url: "{% url 'aumentar_del_carro' 0 %}".replace('0', productId), // Update URL for increasing
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(response) {
                console.log("Response from server:", response); // Debugging log
                if (response.status === 'success') {
                    const product = response.carro.find(product => product.id_producto === productId);
                    if (product) {
                        $(`#producto-${productId} .cantidad`).text(`Cantidad: ${product.cantidad}`); // Update quantity text
                    }
                    actualizarTotal(response.carro); // Update total after quantity change
                    } else {
                    alert(response.message);
                }
            },
            error: function(xhr, errmsg, err) {
            console.log(xhr.status + ": " + xhr.responseText);
    }
});
}
    
    
    function actualizarTotal(carro) {
        let total = 0;
        carro.forEach(function(producto) {
            total += producto.precio * producto.cantidad;
        });
        $('#sumaPago').text('Total: $' + total.toFixed(2)); // Update total in sidepanel
    }

    $(document).ready(function() {
        // Function to render the initial cart in the sidepanel
        function renderCarritoInicial() {
            const carrito = {{ carro|safe }};
            actualizarCarrito(carrito);
        }

        // Call the function to render the cart when the page loads
        renderCarritoInicial();

        // Event listener for add-to-cart buttons
        $('.add-to-cart').on('click', function(e) {
            e.preventDefault();
            const productId = $(this).data('id');
            
            $.ajax({
                url: "{% url 'anadir_al_carro' 0 %}".replace('0', productId),
                type: 'POST',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    if (response.status === 'success') {
                        actualizarCarrito(response.carro);
                    } else {
                        alert(response.message);
                    }
                },
                error: function(xhr, errmsg, err) {
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            });
        });

        // Function to update the cart display in the sidepanel
        function actualizarCarrito(carro) {
            const productosCartside = $('#cartside');

            productosCartside.empty();

            // Add cart title
            productosCartside.append('<h2>Carrito</h2>');

            carro.forEach(function(producto) {
                if (producto.cantidad > 0) {
                    const productoHtml = `
                        <div id="producto-${producto.id_producto}">
                            <img src="${producto.imagen_url}" alt="${producto.nombre}" style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px;">
                            <p>${producto.nombre} - $${producto.precio} - <span class="cantidad">Cantidad: ${producto.cantidad}</span></p>
                            <button onclick="reducirDelCarrito(${producto.id_producto})">-</button>
                            <button onclick="aumentarDelCarrito(${producto.id_producto})">+</button>
                            <button onclick="eliminarDelCarrito(${producto.id_producto})">Eliminar</button>
                        </div>
                    `;
                    productosCartside.append(productoHtml);
                }
            });

            actualizarTotal(carro); // Update total after rendering cart
        }
    });
</script>


</body>
</html>
